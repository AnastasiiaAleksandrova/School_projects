<!DOCTYPE html>
<html>

<head>
  <title>Ventti</title>
  <script src="ventti.js"></script>
  <link rel="stylesheet" type="text/css" href="ventti.css">
</head>

<body>
  <header>
    <button type="button" id="new" onclick="onNewGameCallback()">START NEW GAME</button>
  </header>
  <div id=table>
    <div id="user">
      <h2>My hand</h2>
      <div id="user_hand"></div>
      <button type=button id="take" onclick="onNextMoveCallback()">Take card</button>
      <button type="button" id="stop" onclick="onStopGameCallback()">I don't need more</button>
    </div>
    <div id="host">
      <h2>Host hand</h2>
      <div id="host_hand"></div>

    </div>
  </div>
  <div id="winner"></div>



  <script>
    let game = new Ventti();
    let isHostDone = false;

    function onNewGameCallback() {
      game = new Ventti();
      updateUI();

      document.getElementById("winner").innerHTML = "";
    }

    function onNextMoveCallback() {
      game.playUser();

      if (!isHostDone) {
        isHostDone = !game.playHost();
      }

      updateUI();
    }

    function onStopGameCallback() {
      while (game.playHost()) {}
      updateUI();

      let winner;
      switch (game.getWinner()) {
        case 1:
          winner = "User wins";
          break;
        case 0:
          winner = "Tie";
          break
        case -1:
          winner = "Host wins";
          break;
      }
      document.getElementById("winner").innerHTML = winner;
    }

    function updateUI() {
      document.getElementById("user_hand").innerHTML = game.getUserHand()
        .map(card => getCardHtml(card)).reduce((acc, val) => acc + " " + val, "");

      document.getElementById("host_hand").innerHTML = game.getHostHand()
        .map(card => getCardHtml(card)).reduce((acc, val) => acc + " " + val, "");

    }

    function getCardHtml(card) {
      let suit = Math.floor(card / 100);
      let type = card % 100;
      let html = "";

      if (type > 10) {
        switch (type) {
          case 11:
            html += "J";
            break;
          case 12:
            html += "Q";
            break;
          case 13:
            html += "K";
            break;
          case 14:
            html += "A"
        }
      } else {
        html += type;
      }
      console.log(suit)
      switch (suit) {
        case 1:
          html += '&diams;';
          break;
        case 2:
          html += "&hearts;";
          break;
        case 3:
          html += '&spades;';
          break;
        case 4:
          html += '&clubs;';
          break;
      }

      if (suit == 1 || suit == 2) {
        html = "<font color=\"red\">" + html + "</font>"
      } else {
        html = "<font color=\"black\">" + html + "</font>"
      }

      return html;
    }
  </script>

</body>



</html>